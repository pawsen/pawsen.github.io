:PROPERTIES:
:ID:       dd356f88-407c-4554-8420-c5f7195ed450
:DIR:      ../.attach/diy-battery
:link-img:   ../.attach/diy-battery/*.dwg
:link-img:   ../.attach/diy-battery/*.stp
:link-img:   ../.attach/diy-battery/*.pdf
:END:
#+title: diy-battery

#+HUGO_SECTION: post
#+filetags: batteries li-ion 3d-print
#+hugo_categories: diy
#+hugo_auto_set_lastmod: t
#+hugo_publishdate: 2025-06-08
#+hugo_bundle: diy-liion-battery
#+export_file_name: index
#+macro: imgzoom #+attr_html: :link t

# set org-attach folder specifically for this file
# +PROPERTY: DIR file:img/diy-liion-battery

I have assembled several lithium batteries. For ebikes, usb-c PD powerbanks and larger LiFePO4 for vans. Follow along if you want to try it.
#+hugo: more

For more details see the notes [[id:a1b57a39-78a7-4fc0-91a3-546a2a349a52][on batteries]] and [[id:b87e63b0-7d21-4cb5-8418-ac5f93551ed7][converting an bike to ebike]].
* Bikes
** Electronic parts
- [[https://www.aliexpress.com/item/1005008726633507.html][DC Power Socket Plug, 5.5*2.5]]
- [[https://www.aliexpress.com/item/10000006487848.html][Waterproof cap DC099, DC Power Jack]]
- [[https://www.aliexpress.com/item/1005007327685021.html][JST RCY]] two-wire connectors for connecting on/off switch internally
- [[https://www.aliexpress.com/item/1005006600952774.html][XT30 plugs]] for connecting the charge port internally
- 18awg wire for charging.
- [[https://www.aliexpress.com/item/1005006727482998.html][round on/off switch]]
- 12awg wire for discharging, with silicone insulated it should be good for 30A continuous, 60A peak. (14awg is good for 20A)
- XT60 connector for discharging. Good for 30A cont. 60A peak.
- [[https://www.aliexpress.com/item/1005004892183305.html][JBD Bluetooth mini BMS 7-14S with on/off SW]], Size:63*52*12mm.

** Case

- on/off switch should be on the top to avoid
- XT60 Female panel mount does not seems to be a good idea for the triangle shape. Better with a discharge cable, sealed with gasket seal (like Flex Seal)

** Files
I wrote the manufacturer([[mailto:sale_08@reention.com][sale_08@reention.com]], [[https://www.reention.com/en/xzdch/yingwuxilie/][reention/down-tube/polly]]) for a cell layout. I got a autodesk files(=dwg=) for the cell holders and =pdf= for the cell layout/nickel strips, both for the =-5= and =-5C= version.

*** DP2170-5 (14s4p)
Layouts
#+begin_export hugo
{{< listfiles "*14s4p.pdf" >}}
#+end_export

Autodesk files

#+CAPTION: Screenshot of one of the dwg files, viewed at https://viewer.autodesk.com
[[attachment:polly-dp2170-5-cell-holders.png]]

#+begin_export hugo
{{< listfiles "PLA06*.dwg" >}}
#+end_export


*** DP2170-5C (13s4p)
#+begin_export hugo
{{< listfiles "F20*.pdf" >}}
#+end_export
#+begin_export hugo
{{< listfiles "PLA04*.dwg" >}}
#+end_export
* Powerbanks
** 100W biderction PD with builtin BMS
*** [[https://www.aliexpress.com/item/1005007792926192.html][MYZL-YD24-2.3]]
:PROPERTIES:
:ID:       162485ee-4a16-43a0-a812-522fa0ad84bd
:END:

This is a 100W bidirectional PD module with built-in BMS for 3-5S.
- [[https://www.aliexpress.com/item/1005007792926192.html][MYZL-YD24-2.3]]

There is not much information online.
- One comment said efficiency is around 70-80 % at high current (probably 20V5A PD) for a 4S configuration.
- Same user said the board is unable to charge correctly after full discharge. It falls into some kind of loop from which the only way out is to unsolder the board from the battery, only then can you charge the entire device from 0% battery level.
- Another user did not trust the builtin battery protection and bought a cheap 4S 20A BMS
- For 100W discharge, only one (usb-c) device can be connected.

The battery configuration, capacity, etc, is set by flipping 10 dip-switches. See the link. After assembly, the module is [[https://energo-shop.com/ru/100w-100w-5s-power-bank-type-c-myzl-yd24-2.3/][activated by connecting]] a charger for 5 seconds.

The important part of the config are (SIC)
- Number of cells in series connection (I guess this is independent of the BMS, maybe for CC-CV and input voltage) ::
  - Switch 6: Turn on (ON) to set the number of batteries in the main board of 5 pieces.
  - Switch 7: Turn on (ON) to set the number of batteries in the main board of 4 pieces.
  - Switch 8: Turn on (ON) to set 3 sections of the batteries in the main board.

  If you need to install 2 sections, leave all three switches 6, 7, 8 at the off state (OFF).
  If it is necessary to establish 6 or 7 sections, switches 6, 7, 8 should be switched off (OFF), and the resistor R27 should be replaced by the corresponding denomination according to the resistance table.
- Number of batteries for the safety board (I guess BMS) ::
  - Switch 9: Turn on (ON) to set the number of batteries in the 3 pieces of safety board.
  - Switch 10: Turn on (ON) to set the number of batteries in a security card of 4 pieces.

  If 5 batteries are needed, both switches 9 and 10 should be switched off (OFF).
  Note: Switches 9 and 10 cannot be included(ON) at the same time!

Additional explanations:
- Switches 6, 7, 8 determine the number of batteries in the main board.
- Switches 9, 10 determine the number of batteries in the safety board.
- If the safety board is not used, switches 9 and 10 can be ignored, as the main board contains built-in protection.

I don't really get the additional explanation about the mainboard having builtin protection.

Resistor ~R24~ sets the capacity of the battery. I don't know why this is needed. I guess the %- remaining capacity is calculated from the open voltage, but maybe not. Anyway, the marking on the resistor on my module is ~14C~, [[https://kiloohm.info/eia96-resistor/14C][13.7]]„èÄ, corresponding to 10000mAh. There is a formula to calculate the resistance, see the link to aliexpress.

Resistor ~R18~ sets the function of the button.
- Long press: On small current mode
- double press: turn off
- changing the resistor changes the behavior of a single click.

#+CAPTION: Resistor R24 seen on a microscope. Otherwise I couldn't make out the marking
[[attachment:r24-14c-microscope.jog]]

*** IP2368 with external BMS
Another option is to get a [[https://www.aliexpress.com/item/1005003954338954.html][IP2368]] module, also 100W bidirection, but without a bms. This is 4S by default but can be changed by changing ~R7~ (2-6S).
- Get a 4S20A bms
- add a heatsink on the four mosfet
- optioanlly, extend the leds. Ie. wire and 4 small leds, solder to D1-D4.
- optionally, move the two capacitors and inductor on the backside to the side, extending with wires, for flush mount
See this [[https://youtu.be/QPQXsRYFZLs&t=514][video]].

I would get this module over the [[id:162485ee-4a16-43a0-a812-522fa0ad84bd][WYZL-YD24-2.3]]

*** Making a case
I found an old lead/acid battery and cut off the top with a hacksaw(around where the top part is welded to the box is good). The lead cells are surrounded by acid-soaked pouches, remove them with a plier, and remove the cell walls with a fine cutter, chisel, flush cutter, dremel or whatever is handy.

#+CAPTION: Old lead/acid box with a 4S4P 18650 battery.
[[attachment:100w-case-4s4p.jpg]]



* Vans
